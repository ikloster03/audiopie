---
sidebar_position: 4
---

# Сборка аудиокниг

Процесс сборки конвертирует ваши MP3-треки в единый файл аудиокниги M4B с главами и метаданными.

## Запуск сборки

### Необходимые условия

Перед сборкой убедитесь, что у вас есть:
- ✅ Хотя бы один добавленный трек
- ✅ Название в метаданных
- ✅ (Опционально) Организованные главы
- ✅ (Опционально) Добавленная обложка

### Шаги сборки

1. Нажмите кнопку **Собрать** (значок молотка) в заголовке
2. Выберите место сохранения и имя файла
3. Нажмите **Сохранить**
4. Дождитесь завершения процесса кодирования

## Процесс сборки

Сборка происходит в несколько этапов:

### Этап 1: Анализ

AudioPie читает информацию из ваших исходных треков:
- Аудиокодек и битрейт
- Частота дискретизации
- Длительность
- Количество каналов

### Этап 2: Кодирование

Каждый трек конвертируется в формат AAC:
- Битрейт по умолчанию: 128 кбит/с (настраивается)
- Формат: AAC-LC
- Контейнер: M4A

Прогресс показывается в процентах для каждого трека.

### Этап 3: Добавление глав

Маркеры глав встраиваются в файл:
- Названия глав
- Время начала и окончания
- Индекс главы

### Этап 4: Финализация

Создаётся финальный M4B с:
- Объединённым аудио
- Встроенными метаданными
- Прикреплённой обложкой
- Расширением файла .m4b

## Настройки сборки

### Выходной битрейт

Настраивается в **Настройках**:

| Битрейт | Качество | Размер файла |
|---------|----------|--------------|
| 64 кбит/с | Хорошее (голос) | ~28 МБ/час |
| 96 кбит/с | Лучше | ~42 МБ/час |
| 128 кбит/с | Отличное | ~56 МБ/час |
| 192 кбит/с | Избыточное | ~84 МБ/час |

Для аудиокниг (только голос) 64-96 кбит/с обычно достаточно.

### Место сохранения

По умолчанию диалог файлов открывается в:
- Вашей настроенной папке по умолчанию, или
- Домашней папке/Документы

Вы можете установить папку по умолчанию в **Настройках**.

### Именование файлов

Имя файла по умолчанию основано на названии книги:

```
Название: "Великий Гэтсби"
Имя файла: Великий_Гэтсби.m4b
```

Специальные символы заменяются подчёркиваниями для совместимости.

## Прогресс сборки

Во время сборки модальное окно прогресса показывает:

```
┌─────────────────────────────────────────┐
│           Сборка аудиокниги             │
├─────────────────────────────────────────┤
│                                         │
│  [████████████░░░░░░░░░] 60%            │
│                                         │
│  Кодирование трека 3 из 5...            │
│                                         │
└─────────────────────────────────────────┘
```

:::caution
Не закрывайте AudioPie во время процесса сборки. Это может привести к повреждению выходного файла.
:::

## Производительность сборки

Время сборки зависит от:

| Фактор | Влияние |
|--------|---------|
| Общая длительность аудио | Значительное |
| Количество треков | Незначительное |
| Качество исходных файлов | Незначительное |
| Скорость компьютера | Умеренное |
| Потоки FFmpeg | Умеренное |

Типичные скорости:
- ~2-5x скорости реального времени на современных компьютерах
- 10-часовая аудиокнига: 2-5 минут на сборку

### Оптимизация скорости сборки

В **Настройках** вы можете настроить:

- **Потоки FFmpeg** — Больше потоков = быстрее кодирование (но больше нагрузка на CPU)
- Рекомендуется: Оставить по умолчанию (авто) или установить равным количеству ядер CPU

## Выходной файл

### Формат M4B

Выходной файл — стандартный M4B файл:
- Основан на контейнере MPEG-4
- Аудиокодек AAC
- Маркеры глав (Nero chapters)
- Теги метаданных
- Встроенная обложка

### Совместимость

M4B файлы работают с:

| Плеер | Платформа | Поддержка |
|-------|-----------|-----------|
| Apple Books | macOS, iOS | ✅ Полная |
| Audiobookshelf | Веб, Приложения | ✅ Полная |
| Smart AudioBook Player | Android | ✅ Полная |
| Prologue | iOS | ✅ Полная |
| VLC | Все | ✅ Главы |
| Plex | Сервер | ✅ Полная |

## Устранение неполадок

### Сборка сразу завершается ошибкой

- Проверьте, правильно ли установлен/настроен FFmpeg
- Убедитесь, что все треки — валидные MP3-файлы
- Проверьте место на диске для выходного файла

### Сборка зависает

- Очень длинные треки могут требовать времени
- Проверьте процесс FFmpeg в диспетчере задач
- Попробуйте уменьшить количество потоков FFmpeg в настройках

### В выходном файле нет аудио

- Исходные файлы могут быть повреждены
- Попробуйте перекодировать исходные MP3
- Проверьте вывод ошибок FFmpeg

### Главы отсутствуют

- Убедитесь, что главы были настроены
- Попробуйте пересобрать
- Проверьте выходной файл с помощью `ffprobe`

### Файл слишком большой

- Уменьшите выходной битрейт (64 кбит/с для голоса)
- Убедитесь, что не используете 192+ кбит/с
- Проверьте качество исходных файлов

### Плеер не распознаёт файл

- Переименуйте `.m4b` в `.m4a` и обратно
- Повторно импортируйте в плеер
- Попробуйте другой плеер для проверки целостности файла

